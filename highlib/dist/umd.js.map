{"version":3,"file":"umd.js","sources":["../index.js"],"sourcesContent":["const {\n    Sink,\n    deliver,\n    noop\n} = require('./common')\nexports.Sink = Sink\nexports.pipe = (first, ...cbs) => cbs.reduce((aac, c) => c(aac), first);\n\nclass Reuse {\n    constructor(subscribe, ...args) {\n        this.subscribe = subscribe\n        this.source = exports.pipe(...args)\n    }\n    start() {\n        this.subscriber = this.subscribe(this.source)\n    }\n    stop() {\n        this.subscriber && this.subscriber.dispose()\n    }\n}\n\n//在pipe的基础上增加了start和stop方法，方便反复调用\nexports.reusePipe = (...args) => new Reuse(...args)\n\nexports.toPromise = source => new Promise((resolve, reject) => {\n    const sink = new Sink()\n    sink.next = d => sink.value = d\n    sink.complete = err => err ? reject(err) : resolve(sink.value)\n    source(sink)\n})\n\n//SUBSCRIBER\nexports.subscribe = (n, e = noop, c = noop) => source => {\n    const sink = new Sink()\n    sink.next = n\n    sink.complete = err => err ? e(err) : c()\n    source(sink)\n    return sink\n}\n// UTILITY \nclass Tap extends Sink {\n    init(f) {\n        this.f = f\n    }\n    next(data) {\n        const f = this.f\n        f(data)\n        this.sink.next(data)\n    }\n}\n\nexports.tap = deliver(Tap)\n\nclass Delay extends Sink {\n    init(delay) {\n        this.delayTime = delay\n        this.buffer = []\n        this.timeoutId = [clearTimeout, ,]\n        this.defer(this.timeoutId)\n    }\n    delay(delay) {\n        this.timeoutId[2] = setTimeout(this.pop, delay, this)\n    }\n    pop(_this) {\n        const { time: lastTime, data } = _this.buffer.shift()\n        _this.sink.next(data)\n        if (_this.buffer.length) {\n            _this.delay(_this.buffer[0].time - lastTime)\n        }\n    }\n    next(data) {\n        if (!this.buffer.length) {\n            this.delay(this.delayTime)\n        }\n        this.buffer.push({ time: new Date, data })\n    }\n    complete(err) {\n        if (err) this.sink.complete(err)\n        else {\n            this.timeoutId[2] = setTimeout(() => this.sink.complete(), this.delayTime)\n        }\n    }\n}\nexports.delay = deliver(Delay)\nclass CatchError extends Sink {\n    init(selector) {\n        this.selector = selector\n    }\n    complete(err) {\n        if (err) {\n            this.selector(err)(this.sink)\n        } else {\n            super.complete()\n        }\n    }\n}\nexports.catchError = deliver(CatchError)\nObject.assign(exports, require('./combination'), require('./filtering'), require('./mathematical'), require('./producer'), require('./transformation'), require('./vue3'))\n\nif (typeof Proxy == 'undefined') {\n    const prototype = {};\n    //将一个Observable函数的原型修改为具有所有operator的方法\n    const rx = f => Object.setPrototypeOf(f, prototype);\n    //提供动态添加Obserable以及operator的方法\n    rx.set = ext => {\n        for (let key in ext) {\n            const f = ext[key]\n            switch (key) {\n                case 'Sink':\n                case 'pipe':\n                case 'reusePipe':\n                    break\n                case 'subscribe':\n                    prototype[key] = function (...args) { return f(...args)(this) }\n                    break\n                case 'toPromise':\n                    prototype[key] = function () { return f(this) }\n                    break\n                default:\n                    prototype[key] = function (...args) { return rx(f(...args)(this)) }\n                    rx[key] = (...args) => rx(f(...args))\n            }\n        }\n    }\n    rx.set(exports)\n    exports.rx = rx\n} else {\n    //该代理可以实现将pipe模式转成链式编程\n    const rxProxy = {\n        get: (target, prop) => target[prop] || ((...args) => new Proxy(exports[prop](...args)(target), rxProxy))\n    }\n    exports.rx = new Proxy(f => new Proxy(f, rxProxy), {\n        get: (target, prop) => (...args) => new Proxy(exports[prop](...args), rxProxy),\n        set: (target, prop, value) => exports[prop] = value\n    })\n}"],"names":["require","Sink","deliver","noop","exports","pipe","first","cbs","reduce","aac","c","Reuse","subscribe","args","source","subscriber","this","dispose","reusePipe","toPromise","Promise","resolve","reject","sink","next","d","value","complete","err","n","e","Tap","f","data","tap","Delay","delay","delayTime","buffer","timeoutId","clearTimeout","defer","setTimeout","pop","_this","shift","lastTime","time","length","push","Date","_this2","prototype","rx","rxProxy","CatchError","selector","catchError","Object","assign","Proxy","setPrototypeOf","set","ext","key","get","target","prop"],"mappings":"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"}