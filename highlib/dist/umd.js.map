{"version":3,"file":"umd.js","sources":["../index.js"],"sourcesContent":["const {\r\n    Sink,\r\n    deliver,\r\n    noop\r\n} = require('./common')\r\nexports.Sink = Sink\r\nexports.pipe = (first, ...cbs) => cbs.reduce((aac, c) => c(aac), first);\r\n\r\nclass Reuse {\r\n    constructor(subscribe, ...args) {\r\n        this.subscribe = subscribe\r\n        this.source = exports.pipe(...args)\r\n    }\r\n    start() {\r\n        this.subscriber = this.subscribe(this.source)\r\n    }\r\n    stop() {\r\n        this.subscriber && this.subscriber.dispose()\r\n    }\r\n}\r\n\r\n//在pipe的基础上增加了start和stop方法，方便反复调用\r\nexports.reusePipe = (...args) => new Reuse(...args)\r\n\r\nexports.toPromise = source => new Promise((resolve, reject) => {\r\n    const sink = new Sink()\r\n    sink.next = d => sink.value = d\r\n    sink.complete = err => err ? reject(err) : resolve(sink.value)\r\n    source(sink)\r\n})\r\n\r\n//SUBSCRIBER\r\nexports.subscribe = (n, e = noop, c = noop) => source => {\r\n    const sink = new Sink()\r\n    sink.next = n\r\n    sink.complete = err => err ? e(err) : c()\r\n    source(sink)\r\n    return sink\r\n}\r\n// UTILITY \r\nclass Tap extends Sink {\r\n    init(f) {\r\n        this.f = f\r\n    }\r\n    next(data) {\r\n        const f = this.f\r\n        f(data)\r\n        this.sink.next(data)\r\n    }\r\n}\r\n\r\nexports.tap = deliver(Tap)\r\n\r\nclass Delay extends Sink {\r\n    init(delay) {\r\n        this.delayTime = delay\r\n        this.buffer = []\r\n        this.timeoutId = [clearTimeout, ,]\r\n        this.defer(this.timeoutId)\r\n    }\r\n    delay(delay) {\r\n        this.timeoutId[2] = setTimeout(this.pop, delay, this)\r\n    }\r\n    pop(_this) {\r\n        const { time: lastTime, data } = _this.buffer.shift()\r\n        _this.sink.next(data)\r\n        if (_this.buffer.length) {\r\n            _this.delay(_this.buffer[0].time - lastTime)\r\n        }\r\n    }\r\n    next(data) {\r\n        if (!this.buffer.length) {\r\n            this.delay(this.delayTime)\r\n        }\r\n        this.buffer.push({ time: new Date, data })\r\n    }\r\n    complete(err) {\r\n        if (err) this.sink.complete(err)\r\n        else {\r\n            this.timeoutId[2] = setTimeout(() => this.sink.complete(), this.delayTime)\r\n        }\r\n    }\r\n}\r\nexports.delay = deliver(Delay)\r\nclass CatchError extends Sink {\r\n    init(selector) {\r\n        this.selector = selector\r\n    }\r\n    complete(err) {\r\n        if (err) {\r\n            this.selector(err)(this.sink)\r\n        } else {\r\n            super.complete()\r\n        }\r\n    }\r\n}\r\nexports.catchError = deliver(CatchError)\r\nObject.assign(exports, require('./combination'), require('./filtering'), require('./mathematical'), require('./producer'), require('./transformation'), require('./vue3'))\r\n\r\nif (typeof Proxy == 'undefined') {\r\n    const prototype = {};\r\n    //将一个Observable函数的原型修改为具有所有operator的方法\r\n    const rx = f => Object.setPrototypeOf(f, prototype);\r\n    //提供动态添加Obserable以及operator的方法\r\n    rx.set = ext => {\r\n        for (let key in ext) {\r\n            const f = ext[key]\r\n            switch (key) {\r\n                case 'Sink':\r\n                case 'pipe':\r\n                case 'reusePipe':\r\n                    break\r\n                case 'subscribe':\r\n                    prototype[key] = function (...args) { return f(...args)(this) }\r\n                    break\r\n                case 'toPromise':\r\n                    prototype[key] = function () { return f(this) }\r\n                    break\r\n                default:\r\n                    prototype[key] = function (...args) { return rx(f(...args)(this)) }\r\n                    rx[key] = (...args) => rx(f(...args))\r\n            }\r\n        }\r\n    }\r\n    rx.set(exports)\r\n    exports.rx = rx\r\n} else {\r\n    //该代理可以实现将pipe模式转成链式编程\r\n    const rxProxy = {\r\n        get: (target, prop) => target[prop] || ((...args) => new Proxy(exports[prop](...args)(target), rxProxy))\r\n    }\r\n    exports.rx = new Proxy(f => new Proxy(f, rxProxy), {\r\n        get: (target, prop) => (...args) => new Proxy(exports[prop](...args), rxProxy),\r\n        set: (target, prop, value) => exports[prop] = value\r\n    })\r\n}"],"names":["require","Sink","deliver","noop","exports","pipe","first","cbs","reduce","aac","c","Reuse","subscribe","args","source","subscriber","this","dispose","reusePipe","toPromise","Promise","resolve","reject","sink","next","d","value","complete","err","n","e","Tap","f","data","tap","Delay","delay","delayTime","buffer","timeoutId","clearTimeout","defer","setTimeout","pop","_this","shift","lastTime","time","length","push","Date","_this2","prototype","rx","rxProxy","CatchError","selector","catchError","Object","assign","Proxy","setPrototypeOf","set","ext","key","get","target","prop"],"mappings":"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"}